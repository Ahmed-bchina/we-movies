{% extends 'base.html.twig' %}

{% block title %}Hello MoviesController!{% endblock %}

{% block body %}
<style>
    .example-wrapper { margin: 1em auto; max-width: 800px; width: 95%; font: 18px/1.5 sans-serif; }
    .example-wrapper code { background: #F5F5F5; padding: 2px 6px; }
    
    
    .input-group.md-form.form-sm.form-1 input{
        border: 1px solid #bdbdbd;
        border-top-right-radius: 0.25rem;
        border-bottom-right-radius: 0.25rem;
    }
    .input-group.md-form.form-sm.form-2 input {
        border: 1px solid #bdbdbd;
        border-top-left-radius: 0.25rem;
        border-bottom-left-radius: 0.25rem;
    }
    .input-group.md-form.form-sm.form-2 input.red-border {
        border: 1px solid #ef9a9a;
    }
    .input-group.md-form.form-sm.form-2 input.lime-border {
        border: 1px solid #cddc39;
    }
    .input-group.md-form.form-sm.form-2 input.amber-border {
        border: 1px solid #ffca28;
    }
</style>

<div class="example-wrapper">
    <div id="" class="row">
        <div class="col-md-12">
            {# section search bar #}
            <div class="row">
                <div class="col-md-6">
                    <label for="site-search" style="border-bottom: 1px solid blue;">A propos de We Movies</label>
                </div>
                
                <div class="col-md-6">
                    <div class="input-group md-form form-sm form-2 pl-0">
                        <input class="form-control my-0 py-1" type="text" placeholder="Search" aria-label="Search">
                        <div class="input-group-append">
                            <span class="input-group-text lighten-3" id="basic-text1"><i class="fas fa-search text-grey"
                                aria-hidden="true"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <br><br>

            {# section first best movie #}
            <div class="row">
                <div class="introtext">
                    <a href="https://www.publiciscinemas.com/film/375426/" title="Voir la fiche du film Rosy">
                        <img src='{{base_movie_url}}{{ top_rated_movie.poster_path }}' style="max-width:155px;" alt="Rosy" class=" left">
                    </a>
                    <h3>{{top_rated_movie.title}}</h3>
                    {# <p class="fichefilm_evenement director_cast">Réalisé par <strong>{{top_rated_movie.overview}}</strong><br></p> #}
                    <p class="fichefilm_evenement synopsis">{{top_rated_movie.overview}}
                        <a href="https://www.publiciscinemas.com/film/375426/"> Voir la suite</a>
                    </p>
                    <div class="clr">&nbsp;</div>
                </div>
            </div>
            <br><br>

            {# section genders and list movies #}
            <div class="row">
                <div class="col-md-4">
                    <div style="border: 2px solid #9d9797; padding:30px;">
                    {# list genders #}
                    {% for gender in genders %}
                        <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="genders" onchange="getGenderMovies({{gender.id}}, $(this))" value="" id="{{ gender.id|e }}" data-name="{{ gender.name }}">
                        <label class="form-check-label" for="flexCheckDefault">
                            {{ gender.name|e }}
                        </label>
                        </div>
                    {% endfor %}
                    </div>
                </div>
                <div class="col-md-8">

    <div class="video card no_border">
      <div class="wrapper" style="background-image: url('https://i.ytimg.com/vi/7kTJBmwr9-c/hqdefault.jpg');">
        <a class="no_click play_trailer" href="https://www.themoviedb.org/video/play?key=Op_v2PHDn-0" data-site="YouTube" data-id="7kTJBmwr9-c" data-title="Being The Ricardos – Bande-annonce officielle VOST | Prime Video"><div class="play_background">rrrrrrrrrrr<span class="glyphicons_v2 play invert svg"></span></div></a>
      </div>
    </div>


                    {# list movies #}
                    {% for movie in movies %}
                    <div class="row">
                        <div class="introtext col-md-12">
                            <div class="col-md-4">
                                <a id="{{ movie.title }}" data-id="{{ movie.id }}" class="btn-modal" href="#myModal" data-bs-toggle="modal" data-title="{{ movie.title }}" data-overview="{{ movie.overview }}" title="Voir la fiche du film">
                                    <img src='{{base_movie_url}}{{ movie.poster_path }}' style="max-width:155px; margin-bottom:10px;" alt="Rosy" class=" left">
                                </a>
                            </div>
                            <div class="col-md-8">
                                <p>{{movie.release_date | date('Y')}} <span style="color:blue;">- Disnay, Pixar</span></p>
                                <p>{{movie.overview}}</p>
                                {# <p class="fichefilm_evenement director_cast">Réalisé par <strong>{{top_rated_movie.overview}}</strong><br></p> #}
                                <p class="fichefilm_evenement synopsis">{{movie.overview}}
                                    <a href="https://www.publiciscinemas.com/film/375426/"> Voir la suite</a>
                                </p>
                                <div class="clr">&nbsp;</div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

                        {# <!-- Trigger the modal with a button -->
            <button id="btn-modal" type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#myModal">Open Modal</button> #}

            <!-- Modal -->
            <div id="myModal" class="modal fade" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header" style="border-bottom:none">
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <p class="modal-body-text"></p>
                            <p class="text-secondary"><small>If you don't save, your changes will be lost.</small></p>
                        </div>
                    </div>
                </div>
            </div>

            


        </div>
    </div>

</div>


{% endblock %}

{% block javascripts %}

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function(){

            // the selector will match all input controls of type :checkbox
            // and attach a click event handler 
            $("input:checkbox").on('click', function() {
            // in the handler, 'this' refers to the box clicked on
            var $box = $(this);
            if ($box.is(":checked")) {
                // the name of the box is retrieved using the .attr() method
                // as it is assumed and expected to be immutable
                var group = "input:checkbox[name='" + $box.attr("name") + "']";
                // the checked state of the group/box on the other hand will change
                // and the current value is retrieved using .prop() method
                $(group).prop("checked", false);
                $box.prop("checked", true);
            } else {
                $box.prop("checked", false);
            }
            });

            $(".btn-modal").on('click', function() {
                id = $(this).data('id');
                title = $(this).data('title');
                overview = $(this).data('overview');
                $('.modal-body').html(title + " <br><br> " + overview);
                $('#myModal').modal('show');                
            });
        });

        function getGenderMovies(gender_id, ob){
            var gender_name = ob.data('name');
            if (ob.prop('checked'))
                checked = 1;
            else
                checked = 2;
            
        
            $.ajax({
                type: "POST",
                url: "{{ path('movies') }}",
                data: {
                    gender_id: gender_id,
                    gender_name : gender_name,
                    checked: checked
                }
            })
            .done(function(data){
                if (data.status == "Done")
                {
                    // Inform the user that all went well
                }
                else
                {
                    // Alert the user that something went wrong
                }
            })
            .fail(function()
            {
                // Alert the user that something went wrong
            });
        }

    </script>
{% endblock %}
